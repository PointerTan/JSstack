{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import http from \"http\";\n\nexport default function () {\n    const app = function (req, res) {\n        app.req = req;\n        app.res = res;\n        app.nextIndex = 0;\n        app.next();\n    }\n\n    app.handle = function () {\n        \n    }\n\n    app.hasFather = false;\n    app.isApp = true;\n\n    app.next = function (error) {\n        // console.log(app.nextIndex + \"aa\" + app.stack.length);\n\n        if (app.nextIndex === app.stack.length) {\n            if (app.hasFather) {\n                console.log(\"hasFather and end\");\n                app.father.next(error);\n                return;\n            }\n\n            if (error) {\n                app.res.statusCode = 500;\n                app.res.end(\"error\");\n                return;\n            }\n\n            app.res.statusCode = 404;\n            app.res.end(\"not found\");\n            return;\n        }\n\n        let hasError = false;\n        if (error) {\n            hasError = true;\n        }\n\n        try {\n            let useMethod;\n            do {\n                let tempUseM = app.stack[app.nextIndex];\n                app.nextIndex += 1;\n                if ((hasError && tempUseM.handle.length === 4) || (!hasError && tempUseM.handle.length !== 4)) {\n                    useMethod = tempUseM;\n                    break;\n                }\n            } while (app.nextIndex < app.stack.length);\n\n            let matchObj = useMethod.match(app.req.url)\n            if (matchObj) {\n                app.req.params = matchObj.params;\n            }\n            else {\n                app.req.params = {};\n            }\n\n            if (hasError) {\n                if (useMethod && matchObj) {\n                    useMethod.handle(error, app.req, app.res, app.next);\n                }\n                else {\n                    app.next(error);\n                }\n            }\n            else {\n                if (useMethod && matchObj) {\n                    useMethod.handle(app.req, app.res, app.next);\n                }\n                else {\n                    app.next();\n                }\n            }\n        } catch (error) {\n            app.next(error);\n            // app.res.statusCode = 500;\n            // app.res.end(\"error\");\n            return;\n        }\n    }\n\n    app.stack = [];\n\n    app.listen = function () {\n        const server = http.createServer(app);\n        server.listen(4000);\n    }\n\n    app.use = function (pathOrFunc, useFunc) {\n        var path = \"/\";\n        var func = pathOrFunc;\n        if (typeof pathOrFunc === 'string') {\n            path = pathOrFunc;\n            func = useFunc;\n        }\n\n        var { Layer } = require(\"../lib/layer\");\n        let layer = new Layer(path, func);\n\n        layer.hasFather = true;\n        layer.father = app;\n        app.stack.push(layer);\n    }\n\n    return app;\n}"]}
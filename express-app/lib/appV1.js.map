{"version":3,"sources":["../src/appV1.js"],"names":[],"mappings":";;;;;;kBAEe,YAAY;AACvB,QAAM,MAAM,SAAN,GAAM,CAAU,GAAV,EAAe,GAAf,EAAoB;AAC5B,YAAI,GAAJ,GAAU,GAAV;AACA,YAAI,GAAJ,GAAU,GAAV;;AAEA,YAAI,IAAJ;AACH,KALD;;AAOA,QAAI,SAAJ,GAAgB,KAAhB;AACA,QAAI,KAAJ,GAAY,IAAZ;AACA,QAAI,SAAJ,GAAgB,CAAhB;;AAEA,QAAI,IAAJ,GAAW,UAAU,KAAV,EAAiB;AACxB;;AAEA,YAAI,IAAI,SAAJ,KAAkB,IAAI,KAAJ,CAAU,MAAhC,EAAwC;AACpC,gBAAI,IAAI,SAAR,EAAmB;AACf,wBAAQ,GAAR,CAAY,mBAAZ;AACA,oBAAI,MAAJ,CAAW,IAAX,CAAgB,KAAhB;AACA;AACH;;AAED,gBAAI,KAAJ,EAAW;AACP,oBAAI,GAAJ,CAAQ,UAAR,GAAqB,GAArB;AACA,oBAAI,GAAJ,CAAQ,GAAR,CAAY,OAAZ;AACA;AACH;;AAED,gBAAI,GAAJ,CAAQ,UAAR,GAAqB,GAArB;AACA,gBAAI,GAAJ,CAAQ,GAAR,CAAY,WAAZ;AACA;AACH;;AAED,YAAI,WAAW,KAAf;AACA,YAAI,KAAJ,EAAW;AACP,uBAAW,IAAX;AACH;;AAED,YAAI;AACA,gBAAI,kBAAJ;AACA,eAAG;AACC,oBAAI,WAAW,IAAI,KAAJ,CAAU,IAAI,SAAd,CAAf;AACA,oBAAI,SAAJ,IAAiB,CAAjB;AACA,oBAAK,YAAY,SAAS,MAAT,KAAoB,CAAjC,IAAwC,CAAC,QAAD,IAAa,SAAS,MAAT,KAAoB,CAA7E,EAAiF;AAC7E,gCAAY,QAAZ;AACA;AACH;AACJ,aAPD,QAOS,IAAI,SAAJ,GAAgB,IAAI,KAAJ,CAAU,MAPnC;;AASA,gBAAI,QAAJ,EAAc;AACV,oBAAI,SAAJ,EAAe;AACX,8BAAU,KAAV,EAAiB,IAAI,GAArB,EAA0B,IAAI,GAA9B,EAAmC,IAAI,IAAvC;AACH,iBAFD,MAGK;AACD,wBAAI,IAAJ,CAAS,KAAT;AACH;AACJ,aAPD,MAQK;AACD,oBAAI,SAAJ,EAAe;AACX,8BAAU,IAAI,GAAd,EAAmB,IAAI,GAAvB,EAA4B,IAAI,IAAhC;AACH,iBAFD,MAGK;AACD,wBAAI,IAAJ;AACH;AACJ;AACJ,SA3BD,CA2BE,OAAO,KAAP,EAAc;AACZ,gBAAI,GAAJ,CAAQ,UAAR,GAAqB,GAArB;AACA,gBAAI,GAAJ,CAAQ,GAAR,CAAY,OAAZ;AACA;AACH;AACJ,KA1DD;;AA4DA,QAAI,KAAJ,GAAY,EAAZ;;AAEA,QAAI,MAAJ,GAAa,YAAY;AACrB,YAAM,SAAS,eAAK,YAAL,CAAkB,GAAlB,CAAf;AACA,eAAO,MAAP,CAAc,IAAd;AACH,KAHD;;AAKA,QAAI,GAAJ,GAAU,UAAU,OAAV,EAAmB;AACzB,gBAAQ,SAAR,GAAoB,IAApB;AACA,gBAAQ,MAAR,GAAiB,GAAjB;AACA,YAAI,KAAJ,CAAU,IAAV,CAAe,OAAf;AACH,KAJD;;AAOA,WAAO,GAAP;AACH,C;;AAzFD","file":"appV1.js","sourcesContent":["import http from \"http\";\n\nexport default function () {\n    const app = function (req, res) {\n        app.req = req;\n        app.res = res;\n\n        app.next();\n    }\n\n    app.hasFather = false;\n    app.isApp = true;\n    app.nextIndex = 0;\n\n    app.next = function (error) {\n        // console.log(app.nextIndex + \"aa\" + app.stack.length);\n\n        if (app.nextIndex === app.stack.length) {\n            if (app.hasFather) {\n                console.log(\"hasFather and end\");\n                app.father.next(error);\n                return;\n            }\n\n            if (error) {\n                app.res.statusCode = 500;\n                app.res.end(\"error\");\n                return;\n            }\n\n            app.res.statusCode = 404;\n            app.res.end(\"not found\");\n            return;\n        }\n\n        let hasError = false;\n        if (error) {\n            hasError = true;\n        }\n\n        try {\n            let useMethod;\n            do {\n                let tempUseM = app.stack[app.nextIndex];\n                app.nextIndex += 1;\n                if ((hasError && tempUseM.length === 4) || (!hasError && tempUseM.length !== 4)) {\n                    useMethod = tempUseM;\n                    break;\n                }\n            } while (app.nextIndex < app.stack.length);\n\n            if (hasError) {\n                if (useMethod) {\n                    useMethod(error, app.req, app.res, app.next);\n                }\n                else {\n                    app.next(error);\n                }\n            }\n            else {\n                if (useMethod) {\n                    useMethod(app.req, app.res, app.next);\n                }\n                else {\n                    app.next();\n                }\n            }\n        } catch (error) {\n            app.res.statusCode = 500;\n            app.res.end(\"error\");\n            return;\n        }\n    }\n\n    app.stack = [];\n\n    app.listen = function () {\n        const server = http.createServer(app);\n        server.listen(4000);\n    }\n\n    app.use = function (useFunc) {\n        useFunc.hasFather = true;\n        useFunc.father = app;\n        app.stack.push(useFunc);\n    }\n\n\n    return app;\n}"]}